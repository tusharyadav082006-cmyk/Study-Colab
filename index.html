<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Unified Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <!-- Socket.IO client -->
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
  <div class="container">

    <!-- LEFT: Auth / Dashboard card (centered initially) -->
    <div class="card" id="left-card">
      <img class="hero-img" src="/mnt/data/d2af1843-be23-42ab-b42d-0b753b75f3b8.png" alt="hero" />
      <h1 id="brand">Register</h1>

      <!-- REGISTER -->
      <div id="register-form" class="form">
        <input id="reg-username" placeholder="Username">
        <input id="reg-password" type="password" placeholder="Password">
        <select id="reg-role">
          <option value="student">Student</option>
          <option value="faculty">Faculty</option>
          <option value="admin">Admin</option>
        </select>
        <button class="btn" onclick="register()">Register</button>
        <p class="switch">Already have account? <a href="#" onclick="showLogin()">Login</a></p>
        <p id="reg-msg" class="msg"></p>
      </div>

      <!-- LOGIN -->
      <div id="login-form" class="form hidden">
        <input id="login-username" placeholder="Username">
        <input id="login-password" type="password" placeholder="Password">
        <button class="btn" onclick="login()">Login</button>
        <p class="switch">New user? <a href="#" onclick="showRegister()">Register</a></p>
        <p id="login-msg" class="msg"></p>
      </div>

      <!-- PROFILE -->
      <div id="profile-view" class="form hidden">
        <h2>Profile</h2>
        <div id="profile-info"></div>
        <button class="btn secondary" onclick="logout()">Logout</button>
      </div>

      <!-- DASHBOARD (centered view) -->
      <div id="dashboard-view" class="form hidden">
        <h2 class="dashboard-title">Dashboard</h2>
        <div id="modules-grid" class="modules-grid" aria-live="polite"></div>
        <p id="modules-count"></p>
      </div>
    </div>

    <!-- RIGHT: Module panel (hidden initially) -->
    <div class="module-card hidden" id="module-card">
      <div class="module-header">
        <h2 id="module-title">Module</h2>
        <div>
          <button class="btn small" onclick="backToDashboard()">Back</button>
        </div>
      </div>

      <div id="module-body" class="module-body">

        <!-- Attendance -->
        <div id="attendance-ui" class="module hidden">
          <h3>Attendance</h3>
          <input id="att-group-id" placeholder="Group ID (faculty/admin)">
          <button class="btn" onclick="loadGroupMembers()">Load Group Members</button>

          <div id="group-members-list"></div>

          <div id="present-input" class="hidden">
            <p>Enter present roll numbers separated by comma (e.g. 1,3,5)</p>
            <input id="present-rolls" placeholder="present roll numbers">
            <button class="btn" onclick="submitAttendance()">Mark Attendance</button>
            <pre id="attendance-result"></pre>
          </div>

          <div id="student-view" class="hidden">
            <p>Your roll: <span id="my-roll"></span></p>
            <button class="btn" onclick="viewMyAttendance()">View My Attendance</button>
            <pre id="my-attendance-result"></pre>
          </div>
        </div>

        <!-- LMS -->
        <div id="lms-ui" class="module hidden">
          <h3>LMS</h3>
          <input id="lms-group-id" placeholder="Group ID">
          <div class="row">
            <input id="lms-username" placeholder="Your username">
            <input id="lms-file" type="file">
          </div>
          <button class="btn" onclick="uploadLmsFile()">Upload</button>
          <button class="btn small" onclick="listLmsFiles()">List Files</button>
          <div id="lms-files"></div>
        </div>

        <!-- Progress -->
        <div id="progress-ui" class="module hidden">
          <h3>Progress Report</h3>
          <input id="progress-roll" placeholder="Enter roll number (or leave blank for your roll)">
          <button class="btn" onclick="loadProgress()">Load Report</button>
          <pre id="progress-result"></pre>
        </div>

        <!-- Notifications -->
        <div id="notifications-ui" class="module hidden">
          <h3>Notifications</h3>
          <div id="notif-setup" class="hidden">
            <input id="notif-target" placeholder="group_id or username">
            <textarea id="notif-msg" placeholder="Message"></textarea>
            <select id="notif-type">
              <option value="group">Group</option>
              <option value="user">User</option>
            </select>
            <button class="btn" onclick="sendNotification()">Send</button>
          </div>
          <button class="btn small" onclick="loadMyNotifs()">Load My Notifications</button>
          <div id="notifs-list"></div>
        </div>

        <!-- Chat -->
        <div id="chat-ui" class="module hidden">
          <h3>Group Chat (Realtime)</h3>
          <div class="chat-setup">
            <input id="chat-username" placeholder="Your name">
            <input id="chat-group" placeholder="Group ID (or leave blank to create)">
            <input id="chat-group-name" placeholder="Group name (when creating)">
            <div class="chat-actions">
              <button class="btn small" onclick="createGroup()">Create Group</button>
              <button class="btn small" onclick="joinGroup()">Join Group</button>
              <button class="btn small" onclick="listGroups()">List Groups</button>
            </div>
            <div id="groups-list"></div>
          </div>

          <div id="chat-room" class="hidden">
            <h4 id="chat-room-title"></h4>
            <div id="chat-messages" class="chat-messages"></div>
            <div class="chat-input">
              <input id="chat-message-input" placeholder="Type a message..." oninput="emitTyping()">
              <button class="btn" onclick="sendChatMessage()">Send</button>
            </div>
            <div id="typing-indicator" class="typing"></div>
          </div>
        </div>

        <!-- Exams -->
        <div id="exams-ui" class="module hidden">
          <h3>Exams</h3>
          <input id="exam-title" placeholder="Title">
          <input id="exam-date" placeholder="YYYY-MM-DD">
          <button class="btn" onclick="createExam()">Create Exam</button>
          <button class="btn small" onclick="loadExams()">Load Exams</button>
          <div id="exams-list"></div>
        </div>

        <!-- Calendar -->
        <div id="calendar-ui" class="module hidden">
          <h3>Academic Calendar</h3>
          <p>Use Admin/Faculty to add events via Calendar module (FullCalendar recommended)</p>
          <button class="btn small" onclick="loadEvents()">Load Events</button>
          <div id="events-list"></div>
        </div>

        <!-- Analytics -->
        <div id="analytics-ui" class="module hidden">
          <h3>Analytics</h3>
          <button class="btn small" onclick="loadAnalytics()">Load Analytics</button>
          <pre id="analytics-data"></pre>
        </div>

        <!-- Course -->
        <div id="course-ui" class="module hidden">
          <h3>Course Management</h3>
          <input id="course-title" placeholder="Course title">
          <button class="btn" onclick="createCourse()">Create Course</button>
          <div id="course-list"></div>
        </div>

        <!-- Documents -->
        <div id="docs-ui" class="module hidden">
          <h3>Documents</h3>
          <input id="doc-name" placeholder="Document name">
          <input id="doc-url" placeholder="Document URL">
          <button class="btn" onclick="uploadDoc()">Upload</button>
          <div id="docs-list"></div>
        </div>

        <!-- Storage -->
        <div id="storage-ui" class="module hidden">
          <h3>Storage</h3>
          <button class="btn small" onclick="getUsage()">Get Usage</button>
          <div id="storage-data"></div>
        </div>

        <!-- Tasks -->
        <div id="tasks-ui" class="module hidden">
          <h3>Tasks</h3>
          <input id="task-title" placeholder="Task title">
          <input id="task-assigned" placeholder="Assign to (username)">
          <button class="btn" onclick="createTask()">Create Task</button>
          <div id="task-list"></div>
        </div>

        <!-- User management (admin only) -->
        <div id="user_mgmt-ui" class="module hidden">
          <h3>User Management</h3>
          <button class="btn small" onclick="listUsers()">List Users</button>
          <div id="users-list"></div>
        </div>

      </div>
    </div>

    <!-- Sidebar (hidden initially, shown after selecting module) -->
    <div id="sidebar" class="sidebar hidden" aria-hidden="true">
      <h3 class="sidebar-title">Modules</h3>
      <div id="sidebar-modules"></div>
    </div>

  </div>

  <script src="script.js"></script>
</body>
</html>
